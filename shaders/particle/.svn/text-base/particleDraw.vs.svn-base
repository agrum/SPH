#version 140

in float index;
in vec2 textureCoords;

uniform sampler1D positionTexMap;
uniform sampler1D dttTexMap;
uniform float nbrParticle;
uniform int worldSize;
uniform int expand;
uniform mat4 mv;
uniform mat4 mvp;
uniform int infrared;

out vec2 vTextureCoords;
out float d;
out float vIndex;
out float vX;
out float vY;

void main()
{
	vIndex = (float(index) + 0.5)/nbrParticle;
	vec3 position = texture(positionTexMap, vIndex).xyz * float(worldSize);
	float type = texture(dttTexMap, vIndex).b;
	
	vTextureCoords = textureCoords;
	vec4 cc = mv * vec4(position, 1.0f);
	d=length(cc);
	gl_Position = mvp * vec4(position, 1.0f);
	if(expand == 0 || infrared == 1)
		gl_PointSize = 2500/pow(d, 2.0)/float(worldSize);
	else
		gl_PointSize = 2500*pow(1.0 + type, 3.0)/pow(d, 2.0)/float(worldSize);
	
	vX = texture(positionTexMap, vIndex).x - 0.5;
	vY = texture(positionTexMap, vIndex).y - 0.5;
}
